
## 📋 기능 요구사항 (Functional Requirements)

본 프로젝트는 **대용량 트래픽 상황**을 가정하여, 안정적인 **정산(Billing)**과 **알림 발송(Notification)** 시스템을 구축하는 것을 목표로 합니다.

### 1️⃣ 정산 도메인 (Billing)

| 기능 | 상세 설명 | 비고 |
| --- | --- | --- |
| **대용량 데이터 생성** | 100만 명의 회원 및 500만 건 이상의 통화/데이터 사용 내역 더미 데이터 생성 | Bulk Insert 활용 |
| **월별 정산 배치** | 매월 1일, 전월 사용량을 집계하여 기본료+초과요금-할인을 적용한 최종 청구 금액 계산 | Spring Batch |
| **청구서 생성** | 정산된 결과(`Bill`)와 상세 내역(`BillItem`)을 DB에 저장 | Transaction 보장 |
| **재정산 기능** | 정산 로직 오류 시, 특정 월의 데이터를 롤백하고 다시 정산하는 기능 | Admin 제공 |

### 2️⃣ 알림 도메인 (Notification)

| 기능 | 상세 설명 | 비고 |
| --- | --- | --- |
| **발송 요청 배치** | 정산이 완료된(`READY`) 청구서를 조회하여 Kafka로 발송 이벤트 발행 | **Kafka Producer** |
| **이메일 발송** | Kafka에서 메시지를 소비하여 이메일 템플릿 렌더링 후 발송 (Mocking) | **Kafka Consumer** |
| **발송 결과 처리** | 발송 성공 시 `SENT`, 실패 시 `FAILED`로 DB 상태 업데이트 | 상태 동기화 |
| **실패 건 재처리** | 발송 실패한 건(`FAILED`)만 모아서 다시 Kafka로 전송하는 복구 배치 실행 | Retry 전략 |

### 3️⃣ 관리자 도메인 (Back-office)

| 기능 | 상세 설명 | 비고 |
| --- | --- | --- |
| **배치 수동 실행** | 파라미터(날짜)를 입력하여 정산 및 발송 배치를 즉시 실행 |  |
| **실시간 모니터링** | 배치 진행률, 성공/실패 횟수, Kafka Lag 등을 실시간 대시보드로 제공 | **Grafana** |

---

## 🚀 비기능 요구사항 (Non-Functional Requirements)

100만 건의 데이터를 처리하기 위해 **성능, 안정성, 확장성**에 중점을 두어 설계하였습니다.

### ⚡ 성능 (Performance)

* **Chunk Processing:** 대량의 데이터를 메모리 효율적으로 처리하기 위해 **Chunk 지향 처리(Size: 1000)** 방식을 적용.
* **Bulk Insert:** DB I/O 비용 최소화를 위해 JDBC Batch Update를 활용하여 데이터 적재 속도 개선.
* **Claim Check Pattern:** Kafka 메시지 용량 경량화를 위해 **ID만 전송**하고, Consumer가 DB에서 최신 데이터를 조회하는 방식 채택 (네트워크 부하 감소 및 데이터 정합성 확보).
* **Fetch Join:** N+1 문제 해결을 위해 JPA Fetch Join을 사용하여 조회 쿼리 최적화.

### 🛡️ 안정성 & 신뢰성 (Reliability)

* **At-least-once Delivery:** 카프카의 특성을 고려하여 메시지가 최소 1번은 전달되도록 보장하며, 중복 수신 시 로직단에서 방어.
* **Idempotency (멱등성):** 동일한 메시지가 중복 전달되더라도 **이미 발송된(`SENT`) 건은 스킵**하여 중복 발송 원천 차단.
* **Fault Isolation (장애 격리):** 정산(Batch)과 발송(Kafka) 과정을 분리하여, 발송 서버 장애가 정산 데이터 생성에 영향을 주지 않도록 설계.
* **Graceful Shutdown:** 배포나 서버 종료 시 처리 중인 메시지는 마무리하고 종료되도록 설정.
* * **트랜잭션 무결성:** 대량 데이터 처리 중 오류 발생 시, 해당 회차(Chunk/Step)의 데이터는 원상태로 롤백되거나 처리 상태가 명확히 기록되어야 함.

### 🔭 관측 가능성 (Observability)

* **Monitoring:** Prometheus & Grafana를 연동하여 JVM(CPU, Heap), Batch Job Status, **Kafka Consumer Lag**을 실시간 시각화.
* **Alerting (Planned):** 배치 실패 또는 Consumer Lag 임계치 초과 시 Slack 알림 발송.
* * **로깅 표준화:** 모든 배치는 '시작 시간, 종료 시간, 총 처리 건수, 성공 건수, 실패 건수'를 표준 로그 테이블에 반드시 기록해야 함.

### 🔒 보안 (Security)

* **Personal Data Protection:** 회원의 민감 정보(이메일, 전화번호)는 DB 저장 시 암호화(AES-256) 처리.
* **Log Masking:** 로그 출력 시 개인정보의 일부를 마스킹(`010-****-1234`)하여 보안 사고 예방.

---

<br>

## 기술 스택

### 프론트엔드

<img width="80%" alt="스크린샷 2024-01-22 오후 11 43 48" src="https://github.com/woowacourse-teams/2023-hang-log/assets/45068522/9284b40e-c931-4f04-ac78-9c97a548338e">

### 백엔드

<img width="80%" alt="스크린샷 2024-01-22 오후 11 43 16" src="https://github.com/woowacourse-teams/2023-hang-log/assets/45068522/b64dde4f-9467-4427-a361-e2301657efa4">

### 인프라

<img width="80%" alt="스크린샷 2024-01-22 오후 11 44 27" src="https://github.com/woowacourse-teams/2023-hang-log/assets/45068522/d0e03eb4-e159-405b-b22e-3d3fa79b99b7">

<br>

## 서비스 요청 흐름도

![서비스요청흐름도](링크)

## CI/CD

![CICD](링크)

## 모니터링 구조도

![모니터링 구조도](링크)
## 이미지 요청 흐름도

![이미지 요청 흐름도](링크)

## [디자인 시스템]((링크))

![디자인시스템]((링크))

<br>

## 멤버


### 백엔드

| <img src="(링크)"  width="130" height="130"> | <img src="(링크)" width="130" height="130"> | <img src="(링크)" width="130" height="130"> | <img src="(링크)" width="130" height="130"> 
| :---------------------------------------------------------------------------------------: | :---------------------------------------------------------------------------------------: | :---------------------------------------------------------------------------------------: | :---------------------------------------------------------------------------------------: | :---------------------------------------------------------------------------------------: |
|                             [팀장](링크))                              |                            [팀원]((링크))                             |                            [팀원]((링크))                             |                             [팀원]((링크))                             
